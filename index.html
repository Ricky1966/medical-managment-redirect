<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Auth Redirect</title>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const url    = new URL(window.location.href);
      const params = new URLSearchParams([...url.searchParams]);

      // Se manca type ma c'è il code + email, assumiamo signup
      let type = params.get('type');
      if (!type && params.has('code') && params.has('email')) {
        type = 'signup';
        params.set('type', 'signup');
      }

      let host;
      if (type === 'recovery') {
        host = 'reset-password';
      } else if (type === 'signup') {
        host = 'login-callback';
      } else {
        console.error('Unknown auth type:', type, params.toString());
        return;
      }

      // Ricostruisco tutti i parametri inclusi (ora anche type)
      const deepLink = `io.supabase.flutter://${host}?${params.toString()}`;
      console.log('➔ Deep link:', deepLink);
      window.location.replace(deepLink);
    });
  </script>
</head>
<body>
  <p>Reindirizzamento in corso… apri la console (F12) per i dettagli.</p>
</body>
</html>
